<!DOCTYPE html>
<html>
<head>
<style type="text/css">
  html, body, #map-canvas { margin: 0; padding: 0;}
</style>
<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/kartograph.min.js"></script>
<script src="js/raphael-min.js"></script>
<script src="js/decorateMaps.js"></script>

<script type="text/javascript">
var filter = (function(){
	var url = window.location.href;
	var para = url.split(/[?&]+/);
	if(para.length > 1){
		if (para[1] in filterTowns) return para[1];
		window.location.href = ".";
	}
	return "all";
})()

$(function(){
	var map = kartograph.map('#map');
	map.loadCSS('kartograph/config.css', function() {
		map.loadMap('kartograph/russia_context/russia_laea.svg', function(){
			map.addLayer('mygraticule');
			map.addLayer('world');
			map.addLayer('russia');
			$.ajax({
				url: 'data/monotowns_sorted.json',
				dataType: 'json',
				success: function(cities) {
					var scale = kartograph.scale.sqrt(cities.concat([2]), [2]).range([4, 30]);
					cities = filterTowns[filter](cities);
					console.log("Number of towns displayed: " + cities.length);

					map.addSymbols({
						type: kartograph.Bubble,
						data: cities,
						location: function(city) {
							return [city[4], city[3]];
						},
						radius: function(city) {
							return scale(city[2]);
						},
						sortBy: 'radius desc',
						style: function (city){
							var style = 'fill-opacity: 0.25; stroke: #888; stroke-width:0.15;';
							return style + 'fill: ' + city[city.length-1] + ';';
						}
				 	});
				  map.addSymbols({
						type: kartograph.Bubble,
						data: cities,
						location: function(city) {
							return [city[4], city[3]];
						},
						radius: 1.5,
						sortBy: 'radius desc',
						style: function (city){
							var style = 'stroke: #fff; stroke-width:0.15;';
							return style + ';fill: ' + city[city.length-1] + ';';
						}
					});
				}
			});
		});
	});
})
</script>
</head>
<body>
<div id="map"></div>
</body>
</html>
