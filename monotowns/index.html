<!DOCTYPE html>
<html>
<head>
<style type="text/css">
  html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
</style>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=visualization"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>

<script type="text/javascript">
function initialize() {
  var russia = new google.maps.LatLng(55,103);
  var minZoomLevel = 3;

  var map = new google.maps.Map(document.getElementById('map-canvas'), {
    center: russia,
    zoom: minZoomLevel,
    mapTypeId: google.maps.MapTypeId.TERRAIN
  });

  var circles = []
  $.getJSON('./monotowns_sorted.json', function(towns){
    $.each(towns, function(i, v){
      LatLng = new google.maps.LatLng(v[2], v[3]);
      var color;
      if(v[1] >= 500000){color='#FFFF00';}
      else if(v[1] >= 100000 && v[1] < 500000){color='#FF8800';}
      else if(v[1] >= 50000 && v[1] < 100000){color='#0000FF';}
      else if(v[1] >= 10000 && v[1] < 50000){color='#00FF00';}
      else {color='#FF0000';}
      circles.push(new google.maps.Circle({
        strokeColor: '#000000',
        strokeOpacity: 0.8,
        strokeWeight: 1,
        fillColor: color,
        fillOpacity: 0.55,
        map: map,
        center: LatLng,
        radius: Math.sqrt(v[1]) * 300,
        visible: false
      }));
    });
    for (var i = 0; i < circles.length; i++) {
      circles[i].setVisible(true);
    }
  });

  google.maps.event.addListener(map, 'zoom_changed', function() {
    if (map.getZoom() < minZoomLevel) map.setZoom(minZoomLevel);
  });
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>
